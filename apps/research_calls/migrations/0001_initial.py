# Generated by Django 5.2.11 on 2026-02-11 00:05

import django.core.validators
import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('brokers', '0001_initial'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='ResearchCall',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('symbol', models.CharField(db_index=True, max_length=50)),
                ('exchange', models.CharField(default='NSE', max_length=10)),
                ('company_name', models.CharField(blank=True, max_length=255, null=True)),
                ('sector', models.CharField(blank=True, db_index=True, max_length=100, null=True)),
                ('instrument_type', models.CharField(choices=[('EQUITY', 'Equity'), ('FUTURES', 'Futures'), ('OPTIONS', 'Options'), ('COMMODITY', 'Commodity')], default='EQUITY', max_length=20)),
                ('call_type', models.CharField(choices=[('INTRADAY', 'Intraday'), ('SWING', 'Swing'), ('SHORT_TERM', 'Short Term'), ('MEDIUM_TERM', 'Medium Term'), ('LONG_TERM', 'Long Term'), ('POSITIONAL', 'Positional')], db_index=True, max_length=20)),
                ('action', models.CharField(choices=[('BUY', 'Buy'), ('SELL', 'Sell')], max_length=10)),
                ('entry_price', models.DecimalField(decimal_places=2, max_digits=12, validators=[django.core.validators.MinValueValidator(0.01)])),
                ('target_1', models.DecimalField(decimal_places=2, max_digits=12, validators=[django.core.validators.MinValueValidator(0.01)])),
                ('target_2', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('target_3', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('stop_loss', models.DecimalField(decimal_places=2, max_digits=12, validators=[django.core.validators.MinValueValidator(0.01)])),
                ('timeframe_days', models.IntegerField(blank=True, null=True)),
                ('expected_return_percentage', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('risk_reward_ratio', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('rationale', models.TextField(blank=True, null=True)),
                ('status', models.CharField(choices=[('DRAFT', 'Draft'), ('PENDING_APPROVAL', 'Pending Approval'), ('APPROVED', 'Approved'), ('PUBLISHED', 'Published'), ('ACTIVE', 'Active'), ('TARGET_1_HIT', 'Target 1 Hit'), ('TARGET_2_HIT', 'Target 2 Hit'), ('TARGET_3_HIT', 'Target 3 Hit'), ('STOP_LOSS_HIT', 'Stop Loss Hit'), ('MANUALLY_EXITED', 'Manually Exited'), ('EXPIRED', 'Expired'), ('CLOSED', 'Closed')], db_index=True, default='DRAFT', max_length=30)),
                ('published_at', models.DateTimeField(blank=True, db_index=True, null=True)),
                ('expires_at', models.DateTimeField(blank=True, null=True)),
                ('closed_at', models.DateTimeField(blank=True, null=True)),
                ('actual_return_percentage', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('is_successful', models.BooleanField(blank=True, null=True)),
                ('exit_price', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('exit_reason', models.CharField(blank=True, max_length=100, null=True)),
                ('version', models.IntegerField(default=1)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('approved_by', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_calls', to=settings.AUTH_USER_MODEL)),
                ('broker', models.ForeignKey(db_constraint=False, on_delete=django.db.models.deletion.CASCADE, related_name='research_calls', to='brokers.broker')),
                ('created_by', models.ForeignKey(db_constraint=False, default=1, on_delete=django.db.models.deletion.RESTRICT, related_name='created_calls', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'research_calls',
                'ordering': ['-published_at', '-created_at'],
            },
        ),
        migrations.CreateModel(
            name='ResearchCallEvent',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('event_type', models.CharField(choices=[('CREATED', 'Created'), ('SUBMITTED_FOR_APPROVAL', 'Submitted for Approval'), ('APPROVED', 'Approved'), ('REJECTED', 'Rejected'), ('PUBLISHED', 'Published'), ('TARGET_1_HIT', 'Target 1 Hit'), ('TARGET_2_HIT', 'Target 2 Hit'), ('TARGET_3_HIT', 'Target 3 Hit'), ('STOP_LOSS_HIT', 'Stop Loss Hit'), ('MANUALLY_EXITED', 'Manually Exited'), ('EXPIRED', 'Expired'), ('CLOSED', 'Closed'), ('UPDATED', 'Updated')], max_length=50)),
                ('price_at_event', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('notes', models.TextField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('research_call', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='events', to='research_calls.researchcall')),
                ('triggered_by', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'research_call_events',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='ResearchCallVersion',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('version_number', models.IntegerField()),
                ('changes_json', models.JSONField()),
                ('change_reason', models.TextField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('changed_by', models.ForeignKey(db_constraint=False, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('research_call', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='versions', to='research_calls.researchcall')),
            ],
            options={
                'db_table': 'research_call_versions',
                'ordering': ['-version_number'],
            },
        ),
        migrations.AddIndex(
            model_name='researchcall',
            index=models.Index(fields=['status', 'published_at'], name='research_ca_status_3c65b4_idx'),
        ),
        migrations.AddIndex(
            model_name='researchcall',
            index=models.Index(fields=['broker', 'status'], name='research_ca_broker__1c2387_idx'),
        ),
        migrations.AddIndex(
            model_name='researchcall',
            index=models.Index(fields=['symbol'], name='research_ca_symbol_66dff8_idx'),
        ),
        migrations.AddIndex(
            model_name='researchcall',
            index=models.Index(fields=['call_type', 'status'], name='research_ca_call_ty_d2cbff_idx'),
        ),
        migrations.AddIndex(
            model_name='researchcallevent',
            index=models.Index(fields=['research_call', '-created_at'], name='research_ca_researc_7be604_idx'),
        ),
        migrations.AddIndex(
            model_name='researchcallversion',
            index=models.Index(fields=['research_call', '-version_number'], name='research_ca_researc_1f090f_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='researchcallversion',
            unique_together={('research_call', 'version_number')},
        ),
    ]
