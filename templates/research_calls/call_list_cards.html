{% extends 'base.html' %}
{% load static %}

{% block title %}Live Trades - Stock Research Platform{% endblock %}

{% block content %}
<div class="container">
    <!-- Header with Filters -->
    <div class="page-header">
        <h1>Live Trades</h1>
        <div class="filter-tabs">
            <a href="?timeframe=all" class="filter-tab {% if selected_timeframe == 'all' %}active{% endif %}">All</a>
            <a href="?timeframe=intraday" class="filter-tab {% if selected_timeframe == 'intraday' %}active{% endif %}">Short</a>
            <a href="?timeframe=swing" class="filter-tab {% if selected_timeframe == 'swing' %}active{% endif %}">Medium</a>
            <a href="?timeframe=short_term" class="filter-tab {% if selected_timeframe == 'short_term' %}active{% endif %}">Long</a>
        </div>
    </div>

    <!-- Search and Filters -->
    <div class="filters-section">
        <form method="get" class="filters-form">
            <input type="text" name="search" placeholder="Search by symbol or broker..." value="{{ search_query|default:'' }}" class="search-input">
            
            <select name="broker" class="filter-select">
                <option value="">All Brokers</option>
                {% for broker in brokers %}
                    <option value="{{ broker.id }}" {% if selected_broker == broker.id|stringformat:'s' %}selected{% endif %}>
                        {{ broker.name }}
                    </option>
                {% endfor %}
            </select>
            
            <select name="action" class="filter-select">
                <option value="">All Actions</option>
                <option value="buy" {% if selected_action == 'buy' %}selected{% endif %}>BUY</option>
                <option value="sell" {% if selected_action == 'sell' %}selected{% endif %}">SELL</option>
            </select>
            
            <button type="submit" class="btn btn-primary">Apply Filters</button>
        </form>
    </div>

    <!-- Trade Cards Grid -->
    <div class="trade-cards-grid">
        {% for call in calls %}
        <div class="pro-trade-card">
            <div class="pro-card-header">
                <span class="posted-date">Posted: {{ call.published_at|date:"d M y | h:i A" }}</span>
                <span class="duration-badge">
                    <svg width="12" height="12" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>
                        <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/>
                    </svg>
                    {{ call.get_call_type_display }}
                </span>
            </div>

            <div class="pro-banner">
                Available with all PRO plans
            </div>

            <div class="pro-visual-container">
                <div class="potential-badge">
                    Potential left : {{ call.expected_return_percentage|floatformat:2 }} %
                </div>
                
                {% if user.is_authenticated and user.subscription.is_active %}
                <a href="{% url 'research_calls:detail' call.id %}" class="btn-subscribe-lock">
                    View Trade
                </a>
                {% else %}
                <a href="{% url 'payments:membership' %}" class="btn-subscribe-lock">
                    <svg width="12" height="12" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2zM5 8h6a1 1 0 0 1 1 1v5a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V9a1 1 0 0 1 1-1z"/>
                    </svg>
                    Subscribe Now
                </a>
                {% endif %}
            </div>
        </div>
        {% empty %}
        <div class="no-results">
            <p>No active trades found matching your filters.</p>
        </div>
        {% endfor %}
    </div>
</div>

<style>
.trade-cards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 24px;
    margin-top: 24px;
}
/* Other styles moved to modern_ui.css */
</style>
{% endblock %}
