{% extends 'base.html' %}
{% load static %}
{% block extra_css %}<link rel="stylesheet" href="{% static 'css/market_hero.css' %}">{% endblock %}

{% block content %}
<div class="market-section-page">
  <div class="section-page-container">
    <a href="{% url 'dashboard:home' %}" class="back-link">‚Üê Back to Market Hero</a>
    <div class="section-page-header">
      <div class="section-page-title">üè¢ IPO Centre</div>
      <div class="section-page-desc">Upcoming, open, and recently listed IPOs with performance tracking.</div>
    </div>

    <!-- IPO Stats -->
    {% if ipo_stats %}
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 32px;">
      <div class="widget-card-hero" style="text-align: center; padding: 20px;">
        <div style="font-size: 28px; font-weight: 800; color: var(--accent-green);">{{ ipo_stats.total_upcoming }}</div>
        <div style="font-size: 13px; color: var(--text-muted);">Upcoming IPOs</div>
      </div>
      <div class="widget-card-hero" style="text-align: center; padding: 20px;">
        <div style="font-size: 28px; font-weight: 800; color: var(--accent-blue);">{{ ipo_stats.total_listed }}</div>
        <div style="font-size: 13px; color: var(--text-muted);">Recently Listed</div>
      </div>
      <div class="widget-card-hero" style="text-align: center; padding: 20px;">
        <div style="font-size: 28px; font-weight: 800; color: {% if ipo_stats.avg_listing_return >= 0 %}var(--accent-green){% else %}var(--accent-red){% endif %};">{{ ipo_stats.avg_listing_return }}%</div>
        <div style="font-size: 13px; color: var(--text-muted);">Avg Listing Return</div>
      </div>
    </div>
    {% endif %}

    <!-- Upcoming IPOs -->
    <div class="section-header-hero" style="margin-bottom: 16px;">
      <div class="section-title-hero"><span class="icon">üìã</span> Upcoming IPOs</div>
    </div>
    <div class="widget-card-hero" style="margin-bottom: 32px;">
      <table class="data-table">
        <thead>
          <tr>
            <th>Company</th>
            <th>Sector</th>
            <th>Price Band</th>
            <th>Lot Size</th>
            <th>Open Date</th>
            <th>Close Date</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          {% for ipo in upcoming_ipos %}
          <tr>
            <td style="font-weight: 600;">{{ ipo.company }}</td>
            <td>{{ ipo.sector }}</td>
            <td>{{ ipo.price_band }}</td>
            <td>{{ ipo.lot_size }}</td>
            <td>{{ ipo.open_date }}</td>
            <td>{{ ipo.close_date }}</td>
            <td>
              <span class="ipo-status {% if ipo.status == 'OPEN' %}ipo-open{% elif ipo.status == 'UPCOMING' %}ipo-upcoming{% else %}ipo-closed{% endif %}">
                {{ ipo.status }}
              </span>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="7" style="text-align: center; padding: 30px; color: var(--text-muted);">
              No upcoming IPOs at this time.
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Recently Listed -->
    <div class="section-header-hero" style="margin-bottom: 16px;">
      <div class="section-title-hero"><span class="icon">üÜï</span> Recently Listed</div>
    </div>
    <div class="widget-card-hero">
      <table class="data-table">
        <thead>
          <tr>
            <th>Company</th>
            <th>Sector</th>
            <th>Issue Price</th>
            <th>Current Price</th>
            <th>Return</th>
            <th>Listed Date</th>
          </tr>
        </thead>
        <tbody>
          {% for ipo in recently_listed %}
          <tr>
            <td style="font-weight: 600;">{{ ipo.company }}</td>
            <td>{{ ipo.sector }}</td>
            <td>‚Çπ{{ ipo.issue_price }}</td>
            <td style="font-weight: 700;">‚Çπ{{ ipo.current_price }}</td>
            <td class="{% if ipo.return_pct >= 0 %}text-gain{% else %}text-loss{% endif %}">
              {% if ipo.return_pct >= 0 %}+{% endif %}{{ ipo.return_pct }}%
            </td>
            <td>{{ ipo.listing_date }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" style="text-align: center; padding: 30px; color: var(--text-muted);">
              No recently listed IPOs.
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
